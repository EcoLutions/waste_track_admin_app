<!-- Container Monitoring Dashboard -->
<div class="h-full flex flex-col gap-6">

  <!-- Header con estad√≠sticas -->
  <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
    <div class="bg-white rounded-xl p-4 border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center text-2xl">
          üì¶
        </div>
        <div>
          <div class="text-2xl font-bold text-gray-900">{{ quickStats().total }}</div>
          <div class="text-sm text-gray-500 font-medium">Total</div>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl p-4 border border-green-100 shadow-sm hover:shadow-md transition-shadow">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center text-2xl">
          ‚úÖ
        </div>
        <div>
          <div class="text-2xl font-bold text-green-700">{{ quickStats().active }}</div>
          <div class="text-sm text-gray-500 font-medium">Activos</div>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl p-4 border border-orange-100 shadow-sm hover:shadow-md transition-shadow">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center text-2xl">
          üîß
        </div>
        <div>
          <div class="text-2xl font-bold text-orange-700">{{ quickStats().maintenance }}</div>
          <div class="text-sm text-gray-500 font-medium">Mantenimiento</div>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl p-4 border border-red-100 shadow-sm hover:shadow-md transition-shadow">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center text-2xl">
          ‚ö†Ô∏è
        </div>
        <div>
          <div class="text-2xl font-bold text-red-700">{{ quickStats().highFillLevel }}</div>
          <div class="text-sm text-gray-500 font-medium">Llenos (>80%)</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Controles de filtro -->
  <div class="bg-white rounded-xl p-5 border border-gray-100 shadow-sm">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">

      <!-- Filtro de estado -->
      <div class="flex flex-col gap-2">
        <label class="text-sm font-semibold text-gray-700">Estado</label>
        <select
          class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
          [value]="store.statusFilter()"
          (change)="store.setStatusFilter($any($event.target).value)">
          <option value="ALL">Todos</option>
          <option value="active">Activos</option>
          <option value="maintenance">Mantenimiento</option>
          <option value="decommissioned">Fuera de Servicio</option>
        </select>
      </div>

      <!-- Filtro de tipo -->
      <div class="flex flex-col gap-2">
        <label class="text-sm font-semibold text-gray-700">Tipo</label>
        <select
          class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
          [value]="store.typeFilter()"
          (change)="store.setTypeFilter($any($event.target).value)">
          <option value="ALL">Todos</option>
          <option value="organic">Org√°nico</option>
          <option value="recyclable">Reciclable</option>
          <option value="general">General</option>
        </select>
      </div>

      <!-- B√∫squeda -->
      <div class="flex flex-col gap-2">
        <label class="text-sm font-semibold text-gray-700">Buscar</label>
        <input
          type="text"
          class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
          placeholder="Direcci√≥n, distrito o ID..."
          [value]="store.searchQuery()"
          (input)="store.setSearchQuery($any($event.target).value)">
      </div>

      <!-- Botones de acci√≥n -->
      <div class="flex flex-col gap-2 justify-end">
        <div class="flex gap-2">
          <button
            class="flex-1 px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-300"
            (click)="store.clearFilters()">
            Limpiar
          </button>
          <button
            class="flex-1 px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2"
            (click)="loadContainers()"
            [disabled]="isLoading()">
            {{ isLoading() ? 'Cargando...' : 'Actualizar' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Mapa principal -->
  <div class="z-0 flex-1 bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden relative min-h-[600px]">
    @if (isLoading()) {
      <div class="absolute inset-0 flex flex-col items-center justify-center bg-white/95 backdrop-blur-sm z-10">
        <div class="w-12 h-12 border-4 border-green-600 border-t-transparent rounded-full animate-spin"></div>
        <p class="mt-4 text-gray-600 font-medium">Cargando contenedores...</p>
      </div>
    } @else if (error()) {
      <div class="absolute inset-0 flex flex-col items-center justify-center bg-white z-10 p-6">
        <div class="text-6xl mb-4">‚ùå</div>
        <p class="text-gray-700 text-center mb-6">{{ error() }}</p>
        <button
          class="px-6 py-3 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2"
          (click)="loadContainers()">
          Reintentar
        </button>
      </div>
    } @else {
      <div class="h-full relative">
        <div class="absolute inset-0"
             leaflet
             [leafletOptions]="options()"
             (leafletMapReady)="onMapReady($event)">
        </div>

        <!-- Controles del mapa -->
        <div class="absolute top-4 right-4 z-[1000] flex flex-col gap-2">
          <button
            class="px-4 py-2 bg-white text-gray-700 text-sm font-medium rounded-lg shadow-md hover:bg-gray-50 transition-all focus:outline-none focus:ring-2 focus:ring-green-500 border border-gray-200"
            (click)="simulateRealTimeUpdate()"
            title="Simular actualizaciones en tiempo real">
            üîÑ Tiempo Real
          </button>

          @if (selectedContainer()) {
            <div class="flex items-center gap-2 px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg shadow-md border border-green-700">
              <span><strong>Seleccionado:</strong> {{ selectedContainer()!.id.substring(0, 8) }}</span>
              <button
                class="ml-2 w-5 h-5 flex items-center justify-center hover:bg-green-700 rounded transition-colors"
                (click)="store.selectContainer(null)">
                ‚úï
              </button>
            </div>
          }
        </div>

        <!-- Leyenda del mapa -->
        <div class="absolute bottom-4 left-4 z-[1000] bg-white rounded-lg shadow-md p-4 border border-gray-200">
          <h4 class="text-sm font-semibold text-gray-900 mb-3">Leyenda</h4>
          <div class="space-y-2">
            <div class="flex items-center gap-2">
              <span class="w-3 h-3 bg-green-600 rounded-full"></span>
              <span class="text-sm text-gray-700">Activo</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-3 h-3 bg-orange-600 rounded-full"></span>
              <span class="text-sm text-gray-700">Mantenimiento</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-3 h-3 bg-red-600 rounded-full"></span>
              <span class="text-sm text-gray-700">Fuera de Servicio</span>
            </div>
          </div>
        </div>
      </div>
    }
  </div>

  <!-- Informaci√≥n adicional -->
  @if (containers().length > 0) {
    <div class="bg-white rounded-xl p-4 border border-gray-100 shadow-sm">
      <p class="text-sm text-gray-600">
        Mostrando <span class="font-semibold text-gray-900">{{ containers().length }}</span> contenedores
        @if (hasValidContainers()) {
          (<span class="font-semibold text-green-700">{{ store.getMapContainers().length }}</span> con ubicaci√≥n v√°lida)
        }
      </p>
    </div>
  }
</div>
